---
import ThemeToggle from './ThemeToggle.astro';

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/expertise', label: 'Expertise' },
  { href: '/projects', label: 'Projects' },
  { href: '/stories', label: 'Stories' },
];
---

<header id="main-header" class="fixed top-0 left-0 right-0 z-50 bg-white/95 dark:bg-railway-steel/95 backdrop-blur-sm shadow-sm transition-all duration-300">
  <nav class="section-container py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2 sm:space-x-3 group">
        <div class="flex items-center space-x-1">
          <div class="w-6 h-6 sm:w-8 sm:h-8 bg-primary-600 rounded transform group-hover:rotate-12 transition-transform duration-300"></div>
          <div class="w-6 h-6 sm:w-8 sm:h-8 bg-railway-signal rounded transform group-hover:-rotate-12 transition-transform duration-300"></div>
        </div>
        <span class="text-xl sm:text-2xl font-display font-bold text-railway-steel dark:text-white">RailDevHub</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center space-x-6">
        {navLinks.map(link => (
          <a
            href={link.href}
            class:list={[
              "text-sm font-medium transition-colors duration-200 hover:text-primary-600 dark:hover:text-primary-400",
              currentPath === link.href ? "text-primary-600 dark:text-primary-400" : "text-gray-700 dark:text-gray-300"
            ]}
          >
            {link.label}
          </a>
        ))}
        <ThemeToggle />
      </div>

      <!-- Tablet/Mobile Theme Toggle -->
      <div class="lg:hidden flex items-center">
        <ThemeToggle />
      </div>
    </div>

  </nav>
</header>

<script>
  // Auto-hide header on scroll down, show on scroll up (for mobile/tablet)
  let lastScrollY = window.scrollY;
  let ticking = false;

  function updateHeaderVisibility() {
    const header = document.getElementById('main-header');
    const currentScrollY = window.scrollY;

    if (!header) return;

    // Only apply auto-hide on mobile/tablet (below lg breakpoint)
    if (window.innerWidth < 1024) {
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        // Scrolling down & past 100px - hide header
        header.style.transform = 'translateY(-100%)';
      } else {
        // Scrolling up or at top - show header
        header.style.transform = 'translateY(0)';
      }
    } else {
      // Desktop - always show header
      header.style.transform = 'translateY(0)';
    }

    lastScrollY = currentScrollY;
    ticking = false;
  }

  function onScroll() {
    if (!ticking) {
      window.requestAnimationFrame(updateHeaderVisibility);
      ticking = true;
    }
  }

  // Listen for scroll events
  window.addEventListener('scroll', onScroll, { passive: true });

  // Reset on resize
  window.addEventListener('resize', () => {
    const header = document.getElementById('main-header');
    if (header && window.innerWidth >= 1024) {
      header.style.transform = 'translateY(0)';
    }
  });
</script>
